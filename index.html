<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TABI - Sistema de Controle de Horas Extras</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js" defer></script>
  <link rel="stylesheet" href="index.css">
  <script src="index.js" defer></script>
</head>
<body>

<!-- Header -->
<header class="header">
  <div class="header-content">
    <div class="brand">
      <div class="logo">T</div>
      <div class="brand-text">
        <div class="title">TABI - Controle de Horas Extras</div>
        <div class="subtitle">Sistema Integrado de Gest√£o</div>
      </div>
    </div>
    <div id="clock"></div>
  </div>
</header>

<!-- Main Container -->
<div class="container">
  <!-- Tabs Navigation -->
  <div class="tabs">
    <button class="active" data-tab="tatico">T√ÅTICO</button>
    <button data-tab="noc">NOC</button>
    <button data-tab="supervisor">SUPERVISOR</button>
    <button data-tab="dashboard">DASHBOARD TABI</button>
    <button data-tab="logs">LOGS</button>
  </div>

  <!-- T√ÅTICO Tab -->
  <div id="tatico" class="tab-pane active">
    <div class="grid">
      <div>
        <!-- Registro Form -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Registrar Solicita√ß√£o</h3>
            <span class="text-small text-muted">Cada HC = 10 minutos</span>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="t_date">Data *</label>
              <input type="date" id="t_date" required>
            </div>
            <div class="form-group">
              <label for="t_dmm">DMM</label>
              <input type="text" id="t_dmm" placeholder="Ex: 3¬∞">
            </div>

            <!-- Opera√ß√£o e Segmento -->
            <div class="form-group">
              <label for="t_operation">Opera√ß√£o</label>
              <select id="t_operation">
                <option value="">Selecione...</option>
                <option>VIVO</option>
                <option>TIM</option>
                <option>CLARO</option>
                <option>OI</option>
              </select>
            </div>
            <div class="form-group">
              <label for="t_segment">Segmento</label>
              <select id="t_segment">
                <option value="">Selecione...</option>
                <option>CONTROLE FRONT MOC</option>
                <option>CONTROLE GRE BH</option>
                <option>PR√â PAGO ESE BH</option>
                <option>LABS LAB</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group" style="grid-column: span 2;">
              <label for="t_intervals">Intervalos (10 min) - M√∫ltipla sele√ß√£o com Ctrl</label>
              <select id="t_intervals" multiple></select>
            </div>
            <div class="form-group">
              <label for="t_hc">HC por intervalo</label>
              <input type="number" id="t_hc" min="1" value="1">
            </div>
            <div class="form-group">
              <label for="t_motivo">Motivo</label>
              <input type="text" id="t_motivo" placeholder="Motivo da solicita√ß√£o">
            </div>
          </div>

          <div class="btn-group">
            <button class="btn btn-primary" type="button" onclick="taticoAdd()">‚ûï Adicionar</button>
            <button class="btn btn-secondary" type="button" onclick="taticoClear()">üîÑ Limpar</button>
            <button class="btn btn-success" type="button" onclick="taticoPublish()">üì§ Publicar Rascunhos</button>
          </div>
        </div>

        <!-- Import/Export -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Importar/Exportar</h3>
          </div>
          <div class="btn-group">
            <button class="btn btn-info" type="button" onclick="downloadTemplate()">üì• Template CSV</button>
            <input type="file" id="fileImport" accept=".csv" style="display:none" onchange="handleImport(event)">
            <button class="btn btn-primary" type="button" onclick="document.getElementById('fileImport').click()">üì§ Importar CSV</button>
            <button class="btn btn-secondary" type="button" onclick="exportTatico()">üíæ Exportar Dados</button>
          </div>
        </div>

        <!-- Records Table -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Solicita√ß√µes Registradas</h3>
          </div>
          <div class="table-container">
            <table id="table_tatico">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Opera√ß√£o</th>
                  <th>Segmento</th>
                  <th>DMM</th>
                  <th>Intervalo</th>
                  <th>HC</th>
                  <th>HE (min)</th>
                  <th>Status</th>
                  <th>A√ß√µes</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div>
        <div class="card">
          <h4>Resumo</h4>
          <div class="mt-2">
            <div class="text-small">Total: <strong id="sum_total">0</strong></div>
            <div class="text-small">Rascunhos: <strong id="sum_draft">0</strong></div>
            <div class="text-small">Publicados: <strong id="sum_published">0</strong></div>
            <div class="text-small">Validados: <strong id="sum_validated">0</strong></div>
          </div>
        </div>

        <div class="card">
          <h4>Ajuda</h4>
          <p class="text-small text-muted mt-2">
            ‚Ä¢ 1 HC = 10 minutos<br>
            ‚Ä¢ Selecione m√∫ltiplos intervalos com Ctrl<br>
            ‚Ä¢ Publique para enviar ao NOC
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- NOC Tab -->
  <div id="noc" class="tab-pane">
    <div class="grid">
      <div>
        <!-- Filters -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Filtros</h3>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="n_start">Data In√≠cio</label>
              <input type="date" id="n_start">
            </div>
            <div class="form-group">
              <label for="n_end">Data Fim</label>
              <input type="date" id="n_end">
            </div>
            <div class="form-group">
              <label for="n_segment">Segmento</label>
              <select id="n_segment">
                <option value="">Todas</option>
                <option>CONTROLE FRONT MOC</option>
                <option>CONTROLE GRE BH</option>
                <option>PR√â PAGO ESE BH</option>
                <option>LABS LAB</option>
              </select>
            </div>
            <div class="form-group">
              <label for="n_operation">Opera√ß√£o</label>
              <select id="n_operation">
                <option value="">Todos</option>
                <option>VIVO</option>
                <option>TIM</option>
                <option>CLARO</option>
                <option>OI</option>
              </select>
            </div>
          </div>
          <div class="btn-group">
            <button class="btn btn-primary" type="button" onclick="nocApplyFilter()">üîç Aplicar</button>
            <button class="btn btn-secondary" type="button" onclick="nocClearFilter()">üîÑ Limpar</button>
          </div>
        </div>

        <!-- Consolidated Groups -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Grupos Consolidados</h3>
            <button class="btn btn-success" type="button" onclick="nocValidateSelected()">‚úÖ Validar Selecionados</button>
          </div>
          <div class="table-container">
            <table id="table_noc">
              <thead>
                <tr>
                  <th><input type="checkbox" onchange="toggleAllGroups(this)"></th>
                  <th>Data</th>
                  <th>Opera√ß√£o</th>
                  <th>Segmento</th>
                  <th>HE (h)</th>
                  <th>HC (un)</th>
                  <th>Status</th>
                  <th>A√ß√µes</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Chart -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Visualiza√ß√£o Gr√°fica</h3>
          </div>
          <canvas id="chart_noc" style="max-height: 300px;"></canvas>
        </div>
      </div>

      <!-- Sidebar NOC Reorganizada -->
      <div>
        <!-- Supervisores card reorganizado -->
        <div class="noc-sidebar-card">
          <h4>Supervisores</h4>

          <!-- Filtros dos Supervisores (j√° presentes no HTML; o JS apenas popula) -->
          <div class="supervisor-filters">
            <div class="supervisor-filters-row">
              <div class="form-group">
                <label class="text-small">Opera√ß√£o</label>
                <select id="noc_filter_operation">
                  <option value="">Todas</option>
                  <option>VIVO</option>
                  <option>TIM</option>
                  <option>CLARO</option>
                  <option>OI</option>
                </select>
              </div>

              <div class="form-group">
                <label class="text-small">Segmento</label>
                <select id="noc_filter_segment">
                  <option value="">Todos</option>
                  <option>CONTROLE FRONT MOC</option>
                  <option>CONTROLE GRE BH</option>
                  <option>PR√â PAGO ESE BH</option>
                  <option>LABS LAB</option>
                </select>
              </div>

              <div class="form-group">
                <label class="text-small">Gerente</label>
                <select id="noc_filter_gerente"></select>
              </div>

              <div class="form-group">
                <label class="text-small">Coordenador</label>
                <select id="noc_filter_coordenador"></select>
              </div>

              <div class="form-group">
                <label class="text-small">Supervisor</label>
                <select id="noc_filter_supervisor"></select>
              </div>

              <div class="form-group">
                <label class="text-small">Pesquisar</label>
                <input id="noc_sup_search" placeholder="Nome ou matr√≠cula" type="text">
              </div>
            </div>

            <div class="supervisor-filters-actions">
              <button class="btn btn-primary" id="noc_sup_apply" type="button">Aplicar Filtros</button>
              <button class="btn btn-info" id="noc_sup_refresh" type="button">Atualizar Lista</button>
              <button class="btn btn-secondary" id="noc_sup_clear" type="button">Limpar</button>
            </div>
          </div>

          <!-- Lista de supervisores -->
          <div class="supervisor-list-container">
            <div class="supervisor-list-header">
              <h5>Lista de Supervisores</h5>
              <span class="supervisor-count">0 selecionados</span>
            </div>
            <div id="supervisor_list"></div>
          </div>

          <!-- Adicionar supervisor -->
          <div class="add-supervisor-section">
            <div class="add-supervisor-input">
              <input type="text" id="sup_input" placeholder="Adicionar supervisor (nome)">
              <button class="btn btn-primary" type="button" onclick="addSupervisor()">Adicionar</button>
            </div>
          </div>
        </div>

        <!-- Aprovador -->
        <div class="noc-sidebar-card">
          <div class="aprovador-section">
            <h4>Aprovador</h4>
            <select id="aprovador_select">
              <option value="">Selecione...</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SUPERVISOR Tab -->
  <div id="supervisor" class="tab-pane">
    <!-- (mantive a estrutura que voc√™ j√° tinha; conte√∫do populado pelo JS) -->
    <div class="grid">
      <div>
        <!-- Filters -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Filtros</h3>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="s_start">Data In√≠cio</label>
              <input type="date" id="s_start">
            </div>
            <div class="form-group">
              <label for="s_end">Data Fim</label>
              <input type="date" id="s_end">
            </div>
            <div class="form-group">
              <label for="s_segment">Segmento</label>
              <select id="s_segment">
                <option value="">Todos</option>
                <option>CONTROLE FRONT MOC</option>
                <option>CONTROLE GRE BH</option>
                <option>PR√â PAGO ESE BH</option>
                <option>LABS LAB</option>
              </select>
            </div>
          </div>
          <button class="btn btn-primary" type="button" onclick="supervisorFilter()">Aplicar</button>
        </div>

        <!-- Validated Groups -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Grupos Validados para Atribui√ß√£o</h3>
          </div>
          <div id="validated_groups"></div>
        </div>

        <!-- Colaboradores com HE Atribu√≠das -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Colaboradores com HE Atribu√≠das</h3>
            <span class="text-small text-muted">Per√≠odo selecionado</span>
          </div>
          <div id="assigned_collaborators" class="assigned-collaborators-container"></div>
        </div>
      </div>

      <!-- Sidebar -->
      <div>
        <div class="card">
          <h4>Crit√©rios de Elegibilidade</h4>
          <div class="eligibility-criteria">
            <div class="criteria-item">
              <span class="criteria-icon">üî¥</span>
              <span class="criteria-text">Banco de horas negativo</span>
            </div>
            <div class="criteria-item">
              <span class="criteria-icon">üìä</span>
              <span class="criteria-text">Produtividade adequada</span>
            </div>
            <div class="criteria-item">
              <span class="criteria-icon">‚úÖ</span>
              <span class="criteria-text">Aus√™ncia de restri√ß√µes</span>
            </div>
          </div>
        </div>

        <div class="card">
          <h4>Informa√ß√µes</h4>
          <p class="text-small text-muted mt-2">
            Selecione um grupo validado para atribuir colaboradores aos intervalos de hora extra.
          </p>
        </div>

        <div class="card">
          <h4>Reset Demo</h4>
          <p class="text-small text-muted mt-2">
            Limpa todos os dados e recria colaboradores e registros de demonstra√ß√£o.
          </p>
          <button class="btn btn-warning mt-2" type="button" onclick="resetDemo()">üîÑ Reset Demo</button>
        </div>
      </div>
    </div>
  </div>

  <!-- DASHBOARD TABI Tab -->
  <div id="dashboard" class="tab-pane">
    <div class="dashboard-container">
      <!-- Dashboard Filters -->
      <div class="card dashboard-filters-card">
        <div class="card-header">
          <h3 class="card-title">Filtros do Dashboard</h3>
          <span class="text-small text-muted">Configure os par√¢metros para visualiza√ß√£o</span>
        </div>
        <div class="dashboard-filter-row form-row">
          <div class="form-group">
            <label for="d_start">Data In√≠cio</label>
            <input type="date" id="d_start" value="">
          </div>
          <div class="form-group">
            <label for="d_end">Data Fim</label>
            <input type="date" id="d_end" value="">
          </div>
          <div class="form-group">
            <label for="d_operation">Opera√ß√£o</label>
            <select id="d_operation">
              <option value="">Todas</option>
              <option>VIVO</option>
              <option>TIM</option>
              <option>CLARO</option>
              <option>OI</option>
            </select>
          </div>
          <div class="form-group">
            <label for="d_segment">Segmento</label>
            <select id="d_segment">
              <option value="">Todos</option>
              <option>CONTROLE FRONT MOC</option>
              <option>CONTROLE GRE BH</option>
              <option>PR√â PAGO ESE BH</option>
              <option>LABS LAB</option>
            </select>
          </div>
          <div class="form-group filter-actions">
            <button class="btn btn-primary" type="button" onclick="applyDashboardFilter()">üîç Aplicar Filtros</button>
            <button class="btn btn-secondary" type="button" onclick="clearDashboardFilter()">üîÑ Limpar</button>
          </div>
        </div>
      </div>

      <!-- Dashboard Content (initially hidden) -->
      <div id="dashboard-content" class="dashboard-content" style="display:none;">
        <!-- HE Overview Cards -->
        <div class="he-overview-section card">
          <h3 class="section-title">Vis√£o Geral das Horas Extras</h3>
          <div class="he-cards-grid">
            <div class="he-card he-planejada">
              <div class="he-card-header">
                <span class="he-card-icon">üìã</span>
                <span class="he-card-title">HE Planejada</span>
              </div>
              <div class="he-card-value">145h 30min</div>
              <div class="he-card-subtitle">Total solicitado pelo T√°tico</div>
            </div>

            <div class="he-card he-distribuida">
              <div class="he-card-header">
                <span class="he-card-icon">üì§</span>
                <span class="he-card-title">HE Distribu√≠da</span>
              </div>
              <div class="he-card-value">132h 10min</div>
              <div class="he-card-subtitle">Validada pelo NOC</div>
            </div>

            <div class="he-card he-atribuida">
              <div class="he-card-header">
                <span class="he-card-icon">üë•</span>
                <span class="he-card-title">HE Atribu√≠da</span>
              </div>
              <div class="he-card-value">98h 45min</div>
              <div class="he-card-subtitle">Atribu√≠da pelo Supervisor</div>
            </div>

            <div class="he-card he-realizada">
              <div class="he-card-header">
                <span class="he-card-icon">‚úÖ</span>
                <span class="he-card-title">HE Realizada</span>
              </div>
              <div class="he-card-value">87h 20min</div>
              <div class="he-card-subtitle">Executada pelos colaboradores</div>
            </div>
          </div>
        </div>

        <!-- Charts Section (mockup canvases) -->
        <div class="charts-section">
          <div class="charts-grid">
            <div class="card chart-card">
              <div class="card-header"><h3 class="card-title">HE por Segmento</h3></div>
              <div class="chart-container"><canvas id="chart_he_segmento" style="max-height: 300px;"></canvas></div>
            </div>

            <div class="card chart-card">
              <div class="card-header"><h3 class="card-title">Picos de Chamadas por Hor√°rio</h3></div>
              <div class="chart-container"><canvas id="chart_picos_chamadas" style="max-height: 300px;"></canvas></div>
            </div>

            <div class="card chart-card full-width">
              <div class="card-header"><h3 class="card-title">Evolu√ß√£o das HE - √öltimos 7 dias</h3></div>
              <div class="chart-container"><canvas id="chart_evolucao_diaria" style="max-height: 400px;"></canvas></div>
            </div>
          </div>
        </div>

        <!-- Stats Tables -->
        <div class="stats-section card">
          <div class="stats-grid">
            <div class="stats-card">
              <div class="card-header"><h3 class="card-title">Por Opera√ß√£o</h3></div>
              <div class="stats-table">
                <div class="stats-row header-row">
                  <span>Opera√ß√£o</span><span>Planejada</span><span>Distribu√≠da</span><span>Atribu√≠da</span><span>Realizada</span>
                </div>
                <div class="stats-row"><span class="operation-name">VIVO</span><span>150h</span><span>42h 10min</span><span>38h 45min</span><span>35h 20min</span></div>
                <div class="stats-row"><span class="operation-name">TIM</span><span>110h 20min</span><span>35h 30min</span><span>32h 15min</span><span>29h 40min</span></div>
                <div class="stats-row"><span class="operation-name">CLARO</span><span>90h</span><span>38h 50min</span><span>35h 20min</span><span>32h 10min</span></div>
                <div class="stats-row"><span class="operation-name">OI</span><span>80h 25min</span><span>15h 40min</span><span>12h 25min</span><span>10h 10min</span></div>
              </div>
            </div>

            <div class="stats-card">
              <div class="card-header"><h3 class="card-title">Indicadores</h3></div>
              <div class="indicators-list">
                <div class="indicator-item"><div class="indicator-label">Taxa de Distribui√ß√£o</div><div class="indicator-value success">91%</div></div>
                <div class="indicator-item"><div class="indicator-label">Taxa de Atribui√ß√£o</div><div class="indicator-value warning">75%</div></div>
                <div class="indicator-item"><div class="indicator-label">Taxa de Realiza√ß√£o</div><div class="indicator-value success">88%</div></div>
                <div class="indicator-item"><div class="indicator-label">Efici√™ncia Geral</div><div class="indicator-value info">60%</div></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty state (shown until Apply Filters is clicked) -->
      <div id="dashboard-empty" class="dashboard-empty card" style="text-align:center; padding:2rem;">
        <div class="empty-icon" style="font-size:40px;">üìä</div>
        <h3>Configure os filtros para visualizar o dashboard</h3>
        <p class="text-small text-muted">Selecione o per√≠odo, opera√ß√£o e segmento desejados e clique em "Aplicar Filtros".</p>
      </div>
    </div>
  </div>

  <!-- LOGS Tab -->
  <div id="logs" class="tab-pane">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Logs de Auditoria</h3>
        <button class="btn btn-danger" type="button" onclick="clearLogs()">üóëÔ∏è Limpar Logs</button>
      </div>
      <div class="table-container">
        <table id="table_logs">
          <thead>
            <tr>
              <th>Data/Hora</th>
              <th>Usu√°rio</th>
              <th>A√ß√£o</th>
              <th>Detalhes</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Import Modal -->
<div id="importModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Preview da Importa√ß√£o</h3>
      <button class="btn btn-secondary" type="button" onclick="closeImportModal()">‚úñ</button>
    </div>
    <div class="modal-body">
      <div id="import_preview"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" type="button" onclick="closeImportModal()">Cancelar</button>
      <button class="btn btn-primary" type="button" onclick="confirmImport()">Confirmar Importa√ß√£o</button>
    </div>
  </div>
</div>

<!-- Assignment Modal -->
<div id="assignModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Atribuir Colaboradores</h3>
      <button class="btn btn-secondary" type="button" onclick="closeAssignModal()">‚úñ</button>
    </div>

    <!-- Summary placeholders will be inserted dynamically -->
    <div id="assign_summary" style="padding:0 1.5rem 0.5rem 1.5rem;font-weight:700;text-transform:uppercase"></div>

    <div class="modal-body">
      <div id="assign_content"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" type="button" onclick="closeAssignModal()">Fechar</button>
    </div>
  </div>
</div>

<!-- Hierarchy Modal -->
<div id="hierarchyModal" class="modal">
  <div class="modal-content hierarchy-modal-content">
    <div class="modal-header">
      <h3>Hierarquia do Colaborador</h3>
      <button class="btn btn-secondary" type="button" onclick="closeHierarchyModal()">‚úñ</button>
    </div>
    <div class="modal-body">
      <div id="hierarchy_content"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" type="button" onclick="closeHierarchyModal()">Fechar</button>
    </div>
  </div>
</div>

</body>
</html>
